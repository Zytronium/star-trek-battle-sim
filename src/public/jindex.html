<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Star Trek Battle Simulator</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    :root {
      --starfleet-blue: #0a1f44;
      --starfleet-gold: #ffcc00;
      --klingon-red: #cc0000;
      --romulan-green: #00cc99;
      --borg-purple: #9933cc;
    }

    body {
      background: linear-gradient(135deg, #000428, #004e92);
      color: white;
      min-height: 100vh;
      overflow-x: hidden;
      position: relative;
    }

    body::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(circle at 10% 20%, rgba(0, 78, 146, 0.2) 0%, transparent 20%),
        radial-gradient(circle at 90% 80%, rgba(153, 51, 204, 0.2) 0%, transparent 20%),
        radial-gradient(circle at 50% 50%, rgba(204, 0, 0, 0.1) 0%, transparent 30%);
      z-index: -1;
    }

    .stars {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: -1;
    }

    .star {
      position: absolute;
      background: white;
      border-radius: 50%;
      animation: twinkle var(--duration, 5s) infinite var(--delay, 0s);
    }

    @keyframes twinkle {
      0%, 100% { opacity: 0.2; }
      50% { opacity: 1; }
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    header {
      text-align: center;
      padding: 30px 0;
      position: relative;
    }

    h1 {
      font-size: 3.5rem;
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: 3px;
      text-shadow: 0 0 15px var(--starfleet-gold);
      position: relative;
      display: inline-block;
    }

    h1::after {
      content: "";
      position: absolute;
      bottom: -10px;
      left: 50%;
      transform: translateX(-50%);
      width: 200px;
      height: 4px;
      background: var(--starfleet-gold);
      border-radius: 2px;
    }

    .subtitle {
      font-size: 1.2rem;
      margin-bottom: 30px;
      color: #aaccff;
      max-width: 600px;
      margin: 0 auto 30px;
      line-height: 1.6;
    }

    .app-container {
      display: grid;
      grid-template-columns: 1fr;
      gap: 30px;
      margin-top: 20px;
    }

    @media (min-width: 900px) {
      .app-container {
        grid-template-columns: 1fr 1fr;
      }
    }

    .panel {
      background: rgba(10, 31, 68, 0.7);
      border: 1px solid rgba(0, 204, 255, 0.3);
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 0 20px rgba(0, 150, 255, 0.2);
      backdrop-filter: blur(10px);
      transition: transform 0.3s ease;
    }

    .panel:hover {
      transform: translateY(-5px);
      box-shadow: 0 0 30px rgba(0, 200, 255, 0.3);
    }

    .panel-title {
      font-size: 1.8rem;
      margin-bottom: 20px;
      color: var(--starfleet-gold);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .ship-selection {
      display: flex;
      flex-direction: column;
      gap: 20px;
      margin-bottom: 20px;
    }

    .selection-group {
      background: rgba(0, 20, 50, 0.5);
      border-radius: 10px;
      padding: 20px;
    }

    .selection-group h3 {
      margin-bottom: 15px;
      color: #00ccff;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .ships-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 15px;
    }

    .ship-card {
      background: rgba(0, 40, 80, 0.6);
      border-radius: 8px;
      padding: 15px 10px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 2px solid transparent;
    }

    .ship-card:hover {
      transform: translateY(-3px);
      background: rgba(0, 60, 120, 0.7);
      border-color: var(--starfleet-gold);
    }

    .ship-card.selected {
      background: rgba(0, 100, 200, 0.7);
      border-color: var(--starfleet-gold);
      box-shadow: 0 0 15px rgba(255, 204, 0, 0.5);
    }

    .ship-icon {
      font-size: 2.5rem;
      margin-bottom: 8px;
      color: #aaccff;
    }

    .ship-name {
      font-size: 0.9rem;
      font-weight: bold;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .faction {
      font-size: 0.8rem;
      color: #aaccff;
      margin-top: 5px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-top: 20px;
    }

    .btn {
      background: linear-gradient(135deg, var(--starfleet-blue), #003366);
      color: white;
      border: none;
      padding: 12px 25px;
      border-radius: 30px;
      font-size: 1.1rem;
      font-weight: bold;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 10px;
      transition: all 0.3s ease;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }

    .btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 7px 20px rgba(0, 0, 0, 0.4);
    }

    .btn:active {
      transform: translateY(1px);
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--starfleet-gold), #ff9900);
      color: var(--starfleet-blue);
    }

    .btn-info {
      background: linear-gradient(135deg, var(--romulan-green), #00aa77);
    }

    .btn-danger {
      background: linear-gradient(135deg, var(--klingon-red), #990000);
    }

    .api-response {
      background: rgba(0, 20, 50, 0.5);
      border-radius: 10px;
      padding: 20px;
      margin-top: 20px;
      max-height: 400px;
      overflow-y: auto;
      font-family: 'Courier New', monospace;
      border: 1px solid rgba(0, 200, 255, 0.3);
    }

    .api-response pre {
      white-space: pre-wrap;
      word-break: break-all;
    }

    .battle-log {
      background: rgba(0, 10, 30, 0.7);
      border-radius: 10px;
      padding: 20px;
      margin-top: 20px;
      overflow-y: auto;
      max-height: 400px;
      font-family: 'Courier New', monospace;
      border: 1px solid rgba(0, 200, 255, 0.3);
    }

    .log-entry {
      margin-bottom: 10px;
      padding-bottom: 10px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .log-entry:last-child {
      border-bottom: none;
      margin-bottom: 0;
    }

    .log-player {
      color: var(--starfleet-gold);
    }

    .log-enemy {
      color: var(--klingon-red);
    }

    .log-damage {
      color: #ff6666;
    }

    .log-critical {
      color: #ff3300;
      font-weight: bold;
    }

    .log-info {
      color: #00ccff;
    }

    .log-api {
      color: var(--romulan-green);
    }

    .battle-result {
      margin-top: 20px;
      text-align: center;
      font-size: 1.4rem;
      font-weight: bold;
      padding: 15px;
      border-radius: 10px;
      background: rgba(0, 0, 0, 0.5);
      display: none;
    }

    .victory {
      color: var(--starfleet-gold);
      border: 2px solid var(--starfleet-gold);
    }

    .defeat {
      color: var(--klingon-red);
      border: 2px solid var(--klingon-red);
    }

    .draw {
      color: #00ccff;
      border: 2px solid #00ccff;
    }

    .loading {
      display: none;
      text-align: center;
      padding: 30px;
    }

    .spinner {
      border: 5px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top: 5px solid var(--starfleet-gold);
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    footer {
      text-align: center;
      margin-top: 50px;
      padding: 20px;
      color: #aaccff;
      font-size: 0.9rem;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      h1 {
        font-size: 2.5rem;
      }
      
      .panel {
        padding: 15px;
      }
      
      .ships-grid {
        grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      }
      
      .controls {
        flex-direction: column;
      }
      
      .btn {
        width: 100%;
        justify-content: center;
      }
    }
  </style>
</head>
<body>
  <!-- Starry background -->
  <div class="stars" id="stars"></div>

  <div class="container">
    <header>
      <h1><i class="fas fa-starship"></i> Star Trek Battle Simulator</h1>
      <p class="subtitle">Command your starship and engage in epic battles across the Alpha Quadrant</p>
    </header>

    <div class="app-container">
      <!-- Ship Selection Panel -->
      <div class="panel">
        <h2 class="panel-title"><i class="fas fa-rocket"></i> Ship Selection</h2>
        
        <div class="ship-selection">
          <div class="selection-group">
            <h3><i class="fas fa-user-astronaut"></i> Your Ship</h3>
            <div class="ships-grid" id="player-ships">
              <!-- Player ships will be populated here -->
            </div>
          </div>
          
          <div class="selection-group">
            <h3><i class="fas fa-skull"></i> Enemy Ship</h3>
            <div class="ships-grid" id="enemy-ships">
              <!-- Enemy ships will be populated here -->
            </div>
          </div>
        </div>
        
        <div class="controls">
          <button class="btn btn-info" id="status-btn">
            <i class="fas fa-heartbeat"></i> Check Status
          </button>
          <button class="btn btn-info" id="database-btn">
            <i class="fas fa-database"></i> Database Info
          </button>
          <button class="btn btn-primary" id="battle-btn">
            <i class="fas fa-fighter-jet"></i> Engage Battle
          </button>
          <button class="btn btn-danger" id="reset-btn">
            <i class="fas fa-redo"></i> Reset
          </button>
        </div>
      </div>
      
      <!-- Battle Panel -->
      <div class="panel">
        <h2 class="panel-title"><i class="fas fa-fire"></i> Battle Console</h2>
        
        <div class="api-response" id="api-response">
          <div class="log-entry log-info">Select ships and engage battle to begin</div>
        </div>
        
        <div class="battle-log" id="battle-log">
          <div class="log-entry log-info">Battle logs will appear here</div>
        </div>
        
        <div class="battle-result" id="battle-result"></div>
      </div>
    </div>
    // Check for evasion
    if (Math.random() < (defender.evasion_chance || 0.1)) {
      return { evaded: true };
    }
    
    // Calculate base damage
    let damage = attacker.attack_power * (0.8 + Math.random() * 0.4);
    
    // Check for critical hit
    const isCritical = Math.random() < (attacker.critical_chance || 0.05);
    if (isCritical) {
      damage *= 2.5;
    }
    
    // Apply damage
    const shieldDamage = Math.min(damage, defender.shields);
    const hullDamage = Math.max(0, damage - defender.shields);
    
    defender.shields -= shieldDamage;
    defender.hull -= hullDamage;
    
    return {
      damage: Math.round(damage),
      isCritical,
      shieldDamage: Math.round(shieldDamage),
      hullDamage: Math.round(hullDamage),
      evaded: false
    };
  }
}

    <div class="loading" id="loading">
      <div class="spinner"></div>
      <p id="loading-text">Communicating with Starfleet Command...</p>
    </div>
  </div>
  
  <footer>
    <p>Starfleet Command &copy; 2025 | Priority One Message: Engage at your own risk!</p>
  </footer>

  <script>
    // API Configuration
    const API_BASE_URL = 'http://localhost:5005';
    
    // Create starry background
    function createStars() {
      const starsContainer = document.getElementById('stars');
      const starCount = 200;
      
      for (let i = 0; i < starCount; i++) {
        const star = document.createElement('div');
        star.classList.add('star');
        
        // Random properties
        const size = Math.random() * 3;
        const left = Math.random() * 100;
        const top = Math.random() * 100;
        const duration = 2 + Math.random() * 8;
        const delay = Math.random() * 5;
        
        star.style.width = `${size}px`;
        star.style.height = `${size}px`;
        star.style.left = `${left}%`;
        star.style.top = `${top}%`;
        star.style.setProperty('--duration', `${duration}s`);
        star.style.setProperty('--delay', `${delay}s`);
        
        starsContainer.appendChild(star);
      }
    }
    
    // Fetch ships from API
    async function fetchShips() {
      try {
        showLoading("Accessing starship database...");
        
        const [playerResponse, enemyResponse] = await Promise.all([
          fetch(`${API_BASE_URL}/api/ships`),
          fetch(`${API_BASE_URL}/api/boss-ships`)
        ]);
        
        if (!playerResponse.ok || !enemyResponse.ok) {
          throw new Error('Failed to fetch ship data');
        }
        
        return {
          playerShips: await playerResponse.json(),
          enemyShips: await enemyResponse.json()
        };
      } catch (error) {
        console.error('Failed to fetch ships:', error);
        addLogEntry(`Error: ${error.message}`, 'error');
        return { playerShips: [], enemyShips: [] };
      } finally {
        hideLoading();
      }
    }
    
    // Selected ships
    let selectedPlayerShip = null;
    let selectedEnemyShip = null;
    
    // Initialize the app
    async function initApp() {
      createStars();
      const ships = await fetchShips();
      
      if (ships.playerShips.length > 0 && ships.enemyShips.length > 0) {
        selectedPlayerShip = ships.playerShips[0];
        selectedEnemyShip = ships.enemyShips[0];
        populateShipSelection(ships.playerShips, ships.enemyShips);
      } else {
        addLogEntry("No ships found in database", 'error');
      }
      
      setupEventListeners();
    }
    
    // Populate ship selection
    function populateShipSelection(playerShips, enemyShips) {
      const playerShipsGrid = document.getElementById('player-ships');
      const enemyShipsGrid = document.getElementById('enemy-ships');
      
      // Clear existing content
      playerShipsGrid.innerHTML = '';
      enemyShipsGrid.innerHTML = '';
      
      // Player ships
      playerShips.forEach((ship, index) => {
        const shipCard = createShipCard(ship, 'player', index === 0);
        playerShipsGrid.appendChild(shipCard);
      });
      
      // Enemy ships
      enemyShips.forEach((ship, index) => {
        const shipCard = createShipCard(ship, 'enemy', index === 0);
        enemyShipsGrid.appendChild(shipCard);
      });
    }
    
    // Create a ship card
    function createShipCard(ship, type, isSelected) {
      const shipCard = document.createElement('div');
      shipCard.classList.add('ship-card');
      if (isSelected) shipCard.classList.add('selected');
      
      // Ship icon based on owner/faction
      let iconClass = 'fas fa-starship'; // default
      const owner = ship.owner.toLowerCase();
      
      if (owner.includes("klingon")) iconClass = 'fas fa-bird';
      if (owner.includes("romulan")) iconClass = 'fas fa-feather-alt';
      if (owner.includes("borg")) iconClass = 'fas fa-cube';
      if (owner.includes("8472")) iconClass = 'fas fa-dragon';
      
      shipCard.innerHTML = `
        <div class="ship-icon">
          <i class="${iconClass}"></i>
        </div>
        <div class="ship-name">${ship.name}</div>
        <div class="faction">${ship.owner}</div>
      `;
      
      shipCard.addEventListener('click', () => {
        // Remove selected class from all cards
        document.querySelectorAll(`#${type}-ships .ship-card`).forEach(card => {
          card.classList.remove('selected');
        });
        
        // Add selected class to clicked card
        shipCard.classList.add('selected');
        
        // Update selected ship
        if (type === 'player') {
          selectedPlayerShip = ship;
        } else {
          selectedEnemyShip = ship;
        }
      });
      
      return shipCard;
    }
    
    // Setup event listeners
    function setupEventListeners() {
      // Status button
      document.getElementById('status-btn').addEventListener('click', () => {
        callApi('/api/status', 'status');
      });
      
      // Database button
      document.getElementById('database-btn').addEventListener('click', () => {
        callApi('/api/database', 'database');
      });
      
      // Battle button
      document.getElementById('battle-btn').addEventListener('click', () => {
        runBattleSimulation();
      });
      
      // Reset button
      document.getElementById('reset-btn').addEventListener('click', () => {
        resetBattle();
      });
    }
    
    // Call an API endpoint
    async function callApi(endpoint, action) {
      try {
        showLoading(`Accessing ${action} data from Starfleet database...`);
        
        const response = await fetch(`${API_BASE_URL}${endpoint}`);
        
        if (!response.ok) {
          throw new Error(`API error: ${response.status}`);
        }
        
        const data = await response.json();
        
        // Display API response
        displayApiResponse(data, action);
        
        // Add to battle log
        addLogEntry(`API ${action.toUpperCase()} request completed`, 'api');
        
      } catch (error) {
        console.error(`API call failed: ${error.message}`);
        displayApiResponse({ error: error.message }, 'error');
        addLogEntry(`API ${action.toUpperCase()} failed: ${error.message}`, 'error');
      } finally {
        hideLoading();
      }
    }
    
    // Display API response
    function displayApiResponse(data, action) {
      const apiResponse = document.getElementById('api-response');
      apiResponse.innerHTML = '';
      
      const title = document.createElement('div');
      title.classList.add('log-entry', 'log-api');
      title.textContent = `API Response: ${action.toUpperCase()}`;
      apiResponse.appendChild(title);
      
      const pre = document.createElement('pre');
      pre.textContent = JSON.stringify(data, null, 2);
      apiResponse.appendChild(pre);
      
      // Auto-scroll to bottom
      apiResponse.scrollTop = apiResponse.scrollHeight;
    }
    
    // Run battle simulation
    async function runBattleSimulation() {
      if (!selectedPlayerShip || !selectedEnemyShip) {
        addLogEntry("Please select both ships before engaging", 'error');
        return;
      }
      
      try {
        showLoading("Initiating starship combat simulation...");
        addLogEntry("===== BATTLE SIMULATION STARTED =====", 'info');
        addLogEntry(`Player Ship: ${selectedPlayerShip.name}`, 'player');
        addLogEntry(`Enemy Ship: ${selectedEnemyShip.name}`, 'enemy');
        
        // Call battle simulation API
        const response = await fetch(`${API_BASE_URL}/api/simulate-battle`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            playerShipId: selectedPlayerShip.ship_id,
            enemyShipId: selectedEnemyShip.ship_id
          })
        });
        
        if (!response.ok) {
          throw new Error(`Battle API error: ${response.status}`);
        }
        
        const battleResult = await response.json();
        
        // Display battle logs
        battleResult.logs.forEach(log => {
          addLogEntry(log, 'info');
        });
        
        // Show battle result
        showBattleResult(battleResult.result);
        
        addLogEntry("===== BATTLE SIMULATION COMPLETE =====", 'info');
        
      } catch (error) {
        console.error('Battle simulation failed:', error);
        addLogEntry(`Battle simulation error: ${error.message}`, 'error');
      } finally {
        hideLoading();
      }
    }
    
    // Add entry to battle log
    function addLogEntry(message, type = 'info') {
      const logEntry = document.createElement('div');
      logEntry.classList.add('log-entry');
      
      if (type === 'player') {
        logEntry.classList.add('log-player');
      } else if (type === 'enemy') {
        logEntry.classList.add('log-enemy');
      } else if (type === 'info') {
        logEntry.classList.add('log-info');
      } else if (type === 'api') {
        logEntry.classList.add('log-api');
      } else if (type === 'error') {
        logEntry.classList.add('log-error');
      }
      
      logEntry.innerHTML = message;
      document.getElementById('battle-log').appendChild(logEntry);
      
      // Auto-scroll to bottom
      document.getElementById('battle-log').scrollTop = document.getElementById('battle-log').scrollHeight;
    }
    
    // Show battle result
    function showBattleResult(outcome) {
      const resultElement = document.getElementById('battle-result');
      resultElement.style.display = 'block';
      
      if (outcome === 'victory') {
        resultElement.textContent = 'MISSION ACCOMPLISHED! VICTORY IS YOURS!';
        resultElement.className = 'battle-result victory';
        addLogEntry(`${selectedPlayerShip.name} emerges victorious!`, 'player');
      } else if (outcome === 'defeat') {
        resultElement.textContent = 'SHIP DESTROYED! MISSION FAILED!';
        resultElement.className = 'battle-result defeat';
        addLogEntry(`${selectedPlayerShip.name} has been destroyed!`, 'enemy');
      } else {
        resultElement.textContent = 'BATTLE ENDS IN A DRAW!';
        resultElement.className = 'battle-result draw';
        addLogEntry('Battle ends in a stalemate!', 'info');
      }
    }
    
    // Reset battle
    function resetBattle() {
  // Clear logs
  document.getElementById('api-response').innerHTML = 
    '<div class="log-entry log-info">Select ships and engage battle to begin</div>';
  
  document.getElementById('battle-log').innerHTML = 
    '<div class="log-entry log-info">Battle logs will appear here</div>';
  
  // Hide battle result
  document.getElementById('battle-result').style.display = 'none';
  
  // Reset ship selection
  document.querySelectorAll('.ship-card').forEach(card => {
    card.classList.remove('selected');
  });
  
  // Select first ships
  const playerCards = document.querySelectorAll('#player-ships .ship-card');
  const enemyCards = document.querySelectorAll('#enemy-ships .ship-card');
  
  if (playerCards.length > 0 && enemyCards.length > 0) {
    playerCards[0].classList.add('selected');
    enemyCards[0].classList.add('selected');
    
    // Update selected ships
    if (playerShipsList.length > 0) selectedPlayerShip = playerShipsList[0];
    if (enemyShipsList.length > 0) selectedEnemyShip = enemyShipsList[0];
  }
  
  addLogEntry("Battle simulation reset", 'info');
}
    
    // Show loading indicator
    function showLoading(message) {
      document.getElementById('loading').style.display = 'block';
      document.getElementById('loading-text').textContent = message;
    }
    
    // Hide loading indicator
    function hideLoading() {
      document.getElementById('loading').style.display = 'none';
    }
    
    // Initialize the app when the page loads
    window.addEventListener('DOMContentLoaded', initApp);
  </script>
</body>
</html>